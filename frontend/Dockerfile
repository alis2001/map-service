FROM node:18-alpine as build
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .

# Build arguments for ALL environment variables
ARG REACT_APP_API_BASE_URL="http://localhost:5001"
ARG REACT_APP_API_VERSION="v1"
ARG REACT_APP_GOOGLE_MAPS_API_KEY
ARG REACT_APP_APP_NAME="CoffeeFinder"
ARG REACT_APP_DEFAULT_LOCATION_LAT="45.0703"
ARG REACT_APP_DEFAULT_LOCATION_LNG="7.6869"
ARG REACT_APP_DEFAULT_ZOOM="15"
ARG REACT_APP_ENABLE_GEOLOCATION="true"
ARG REACT_APP_ENABLE_ANIMATIONS="true"
ARG REACT_APP_CACHE_DURATION="300000"
ARG REACT_APP_DEBUG_MODE="true"

# Set ALL environment variables
ENV REACT_APP_API_BASE_URL=$REACT_APP_API_BASE_URL
ENV REACT_APP_API_VERSION=$REACT_APP_API_VERSION
ENV REACT_APP_GOOGLE_MAPS_API_KEY=$REACT_APP_GOOGLE_MAPS_API_KEY
ENV REACT_APP_APP_NAME=$REACT_APP_APP_NAME
ENV REACT_APP_DEFAULT_LOCATION_LAT=$REACT_APP_DEFAULT_LOCATION_LAT
ENV REACT_APP_DEFAULT_LOCATION_LNG=$REACT_APP_DEFAULT_LOCATION_LNG
ENV REACT_APP_DEFAULT_ZOOM=$REACT_APP_DEFAULT_ZOOM
ENV REACT_APP_ENABLE_GEOLOCATION=$REACT_APP_ENABLE_GEOLOCATION
ENV REACT_APP_ENABLE_ANIMATIONS=$REACT_APP_ENABLE_ANIMATIONS
ENV REACT_APP_CACHE_DURATION=$REACT_APP_CACHE_DURATION
ENV REACT_APP_DEBUG_MODE=$REACT_APP_DEBUG_MODE

RUN npm run build

FROM nginx:alpine
COPY --from=build /app/build /usr/share/nginx/html
COPY default.conf /etc/nginx/conf.d/default.conf
RUN apk add --no-cache curl
EXPOSE 3001
CMD ["nginx", "-g", "daemon off;"]
